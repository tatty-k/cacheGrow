<%- include('../partials/header') %>

<main id="single-goal-view">

    <div class="card" id="progress-container">
        <div id="goal_title"><%=goal.savingsPurpose%></div>
        <canvas id="doughnut-chart" width="400" height="225"></canvas>
        <div id="progress"><%= goal.percentToComplete %>%</div>
        <div id="range-container">
            <div id="range-start">$0</div>
            <div id="range-end">$<%=goal.goal%></div>
        </div>
    </div>    
    

    <form id="add-savings" action="/users/goals/<%=goal._id%>/savings" method="POST"> 
            <input class="input form-control" type="number" step="0.01" name="savingAmount" placeholder="Amount saved" required>
            <input class="input form-control" type="text" name="savingStrategy" class="form-control" placeholder="Strategy used to save" required> 
        <button type="submit" class="btn btn-success">Submit</button> 
    </form> 

    <% if (goal.progress.length === 0){ %>
    <div class="table-title" id="savings-timeline">You have not entered any savings for this goal. Use the form above to get started</div>
    <% } %>

    <table class="table mx-auto">

            <tbody>
                <% goal.progress.forEach(function(s) { %>
                <tr>
                    <td scope="row"> $ <%= s.savingAmount %> </td>
                    <td> <%= s.savingStrategy %> </td>
                    <td>  
                        <form action="/users/goals/<%=goal._id%>/savings/<%=s._id%>?_method=DELETE" method="POST">
                            <button type="submit">Delete</button>
                        </form>
                    </td>
                </tr>
                <% }); %>
            </tbody>
        </table>



        <script>    
                new Chart(document.getElementById("doughnut-chart"), {
                    type: 'doughnut',
                    data: {
                        datasets: [{ 
                            backgroundColor: ["#8e5ea2", "#EDEBEC"],
                            data: [<%= goal.percentToComplete %>, <%= 100-goal.percentToComplete %>]
                        }]
                    },
                    options: {
                        rotation: 1 * Math.PI,
                        circumference: 1 * Math.PI,
                        tooltips: {
                            enabled: false
                            },
                        title: {
                            display: false,
                            text: '<%=goal.savingsPurpose%>',
                            fontSize: 20,
                            fontColor: 'black'
                            },
                        responsive: true,
                    }
                    
                });
                    
            </script>

</main>
<%- include('../partials/footer') %>        
